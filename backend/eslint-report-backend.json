[{"filePath":"D:\\fullstack-chat-app\\backend\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fullstack-chat-app\\backend\\src\\controllers\\auth.controller.js","messages":[{"ruleId":"sonarjs/no-duplicate-string","severity":1,"message":"Define a constant instead of duplicating this literal 4 times.","line":46,"column":37,"nodeType":"Literal","endLine":46,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { generateToken } from \"../lib/utils.js\";\r\nimport User from \"../models/user.model.js\";\r\nimport bcrypt from \"bcryptjs\";\r\nimport cloudinary from \"../lib/cloudinary.js\";\r\n\r\nexport const signup = async (req, res) => {\r\n  const { fullName, email, password } = req.body;\r\n  try {\r\n    if (!fullName || !email || !password) {\r\n      return res.status(400).json({ message: \"All fields are required\" });\r\n    }\r\n\r\n    if (password.length < 6) {\r\n      return res.status(400).json({ message: \"Password must be at least 6 characters\" });\r\n    }\r\n\r\n    const user = await User.findOne({ email });\r\n\r\n    if (user) return res.status(400).json({ message: \"Email already exists\" });\r\n\r\n    const salt = await bcrypt.genSalt(10);\r\n    const hashedPassword = await bcrypt.hash(password, salt);\r\n\r\n    const newUser = new User({\r\n      fullName,\r\n      email,\r\n      password: hashedPassword,\r\n    });\r\n\r\n    if (newUser) {\r\n      // generate jwt token here\r\n      generateToken(newUser._id, res);\r\n      await newUser.save();\r\n\r\n      res.status(201).json({\r\n        _id: newUser._id,\r\n        fullName: newUser.fullName,\r\n        email: newUser.email,\r\n        profilePic: newUser.profilePic,\r\n      });\r\n    } else {\r\n      res.status(400).json({ message: \"Invalid user data\" });\r\n    }\r\n  } catch (error) {\r\n    console.log(\"Error in signup controller\", error.message);\r\n    res.status(500).json({ message: \"Internal Server Error\" });\r\n  }\r\n};\r\n\r\nexport const login = async (req, res) => {\r\n  const { email, password } = req.body;\r\n  try {\r\n    const user = await User.findOne({ email });\r\n\r\n    if (!user) {\r\n      return res.status(400).json({ message: \"Invalid credentials\" });\r\n    }\r\n\r\n    const isPasswordCorrect = await bcrypt.compare(password, user.password);\r\n    if (!isPasswordCorrect) {\r\n      return res.status(400).json({ message: \"Invalid credentials\" });\r\n    }\r\n\r\n    generateToken(user._id, res);\r\n\r\n    res.status(200).json({\r\n      _id: user._id,\r\n      fullName: user.fullName,\r\n      email: user.email,\r\n      profilePic: user.profilePic,\r\n    });\r\n  } catch (error) {\r\n    console.log(\"Error in login controller\", error.message);\r\n    res.status(500).json({ message: \"Internal Server Error\" });\r\n  }\r\n};\r\n\r\nexport const logout = (req, res) => {\r\n  try {\r\n    res.cookie(\"jwt\", \"\", { maxAge: 0 });\r\n    res.status(200).json({ message: \"Logged out successfully\" });\r\n  } catch (error) {\r\n    console.log(\"Error in logout controller\", error.message);\r\n    res.status(500).json({ message: \"Internal Server Error\" });\r\n  }\r\n};\r\n\r\nexport const updateProfile = async (req, res) => {\r\n  try {\r\n    const { profilePic } = req.body;\r\n    const userId = req.user._id;\r\n\r\n    if (!profilePic) {\r\n      return res.status(400).json({ message: \"Profile pic is required\" });\r\n    }\r\n\r\n    const uploadResponse = await cloudinary.uploader.upload(profilePic);\r\n    const updatedUser = await User.findByIdAndUpdate(\r\n      userId,\r\n      { profilePic: uploadResponse.secure_url },\r\n      { new: true }\r\n    );\r\n\r\n    res.status(200).json(updatedUser);\r\n  } catch (error) {\r\n    console.log(\"error in update profile:\", error);\r\n    res.status(500).json({ message: \"Internal server error\" });\r\n  }\r\n};\r\n\r\nexport const checkAuth = (req, res) => {\r\n  try {\r\n    res.status(200).json(req.user);\r\n  } catch (error) {\r\n    console.log(\"Error in checkAuth controller\", error.message);\r\n    res.status(500).json({ message: \"Internal Server Error\" });\r\n  }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fullstack-chat-app\\backend\\src\\controllers\\message.controller.js","messages":[{"ruleId":"sonarjs/no-duplicate-string","severity":1,"message":"Define a constant instead of duplicating this literal 3 times.","line":15,"column":35,"nodeType":"Literal","endLine":15,"endColumn":58}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import User from \"../models/user.model.js\";\r\nimport Message from \"../models/message.model.js\";\r\n\r\nimport cloudinary from \"../lib/cloudinary.js\";\r\nimport { getReceiverSocketId, io } from \"../lib/socket.js\";\r\n\r\nexport const getUsersForSidebar = async (req, res) => {\r\n  try {\r\n    const loggedInUserId = req.user._id;\r\n    const filteredUsers = await User.find({ _id: { $ne: loggedInUserId } }).select(\"-password\");\r\n\r\n    res.status(200).json(filteredUsers);\r\n  } catch (error) {\r\n    console.error(\"Error in getUsersForSidebar: \", error.message);\r\n    res.status(500).json({ error: \"Internal server error\" });\r\n  }\r\n};\r\n\r\nexport const getMessages = async (req, res) => {\r\n  try {\r\n    const { id: userToChatId } = req.params;\r\n    const myId = req.user._id;\r\n\r\n    const messages = await Message.find({\r\n      $or: [\r\n        { senderId: myId, receiverId: userToChatId },\r\n        { senderId: userToChatId, receiverId: myId },\r\n      ],\r\n    });\r\n\r\n    res.status(200).json(messages);\r\n  } catch (error) {\r\n    console.log(\"Error in getMessages controller: \", error.message);\r\n    res.status(500).json({ error: \"Internal server error\" });\r\n  }\r\n};\r\n\r\nexport const sendMessage = async (req, res) => {\r\n  try {\r\n    const { text, image } = req.body;\r\n    const { id: receiverId } = req.params;\r\n    const senderId = req.user._id;\r\n\r\n    let imageUrl;\r\n    if (image) {\r\n      // Upload base64 image to cloudinary\r\n      const uploadResponse = await cloudinary.uploader.upload(image);\r\n      imageUrl = uploadResponse.secure_url;\r\n    }\r\n\r\n    const newMessage = new Message({\r\n      senderId,\r\n      receiverId,\r\n      text,\r\n      image: imageUrl,\r\n    });\r\n\r\n    await newMessage.save();\r\n\r\n    const receiverSocketId = getReceiverSocketId(receiverId);\r\n    if (receiverSocketId) {\r\n      io.to(receiverSocketId).emit(\"newMessage\", newMessage);\r\n    }\r\n\r\n    res.status(201).json(newMessage);\r\n  } catch (error) {\r\n    console.log(\"Error in sendMessage controller: \", error.message);\r\n    res.status(500).json({ error: \"Internal server error\" });\r\n  }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\fullstack-chat-app\\backend\\src\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fullstack-chat-app\\backend\\src\\lib\\cloudinary.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fullstack-chat-app\\backend\\src\\lib\\db.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fullstack-chat-app\\backend\\src\\lib\\socket.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fullstack-chat-app\\backend\\src\\lib\\utils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fullstack-chat-app\\backend\\src\\middleware\\auth.middleware.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fullstack-chat-app\\backend\\src\\models\\message.model.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fullstack-chat-app\\backend\\src\\models\\user.model.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fullstack-chat-app\\backend\\src\\routes\\auth.route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fullstack-chat-app\\backend\\src\\routes\\message.route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\fullstack-chat-app\\backend\\src\\seeds\\user.seed.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]